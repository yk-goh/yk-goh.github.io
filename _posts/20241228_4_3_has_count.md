```python
In [1]:


import pandas as pd
import matplotlib.pyplot as plt 
import seaborn as sns
import numpy as np
pd.set_option('display.max_columns', None)
pd.set_option('display.max_rows', None)
pd.set_option('display.float_format', lambda x: '%.3f' %x)
np.set_printoptions(suppress=True)
from matplotlib import font_manager, rc
```

```python
In [2]:


df = pd.read_csv('241228_template_did.csv', index_col=0)

df.dropna(inplace=True)
print(df.shape)
df.drop_duplicates(inplace=True, subset=['join_sn', 'did_credit_change'])
print(df.shape)
```

```
C:\ProgramData\Anaconda3\lib\site-packages\numpy\lib\arraysetops.py:583: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison
  mask |= (ar1 == a)






(9567841, 6)
(615820, 6)
```

```python
In [3]:


df = df[['join_sn', 'did_credit_change']]
df['hl'] = df['did_credit_change'].apply(lambda x: 1 if x == 'high_low' else 0)

df.head()

df['did_credit_change'].value_counts()
```

```
Out[3]:

high_high    571870
high_low      43950
Name: did_credit_change, dtype: int64
```

```python
In [4]:


df_credit_pre = df[['join_sn', 'hl']]

df_201912 = df_credit_pre.assign(ym=201912)
df_202112 = df_credit_pre.assign(ym=202112)
df_credit = pd.concat([df_201912, df_202112], ignore_index=True)
```

```python
In [5]:


df_cnt = pd.read_csv('../INSURANCE_CNT_CONTRACT_I_VER3.csv')
```

```python
In [6]:


# 생명보험(종신+정기)
df_cnt['life'] = df_cnt['i_cnt_whole']+df_cnt['i_cnt_term']
# 건강보험(질병+암)
df_cnt['disease'] = df_cnt['i_cnt_disease'] + df_cnt['i_cnt_cancer']
# 저축성보험
df_cnt['saving'] = df_cnt['i_cnt_pen_sv'] + df_cnt['i_cnt_pen'] + df_cnt['i_cnt_sv'] + df_cnt['i_cnt_ed']
# 화재보험
df_cnt['fire'] = df_cnt['i_cnt_fire'] + df_cnt['i_cnt_liability'] + df_cnt['i_cnt_fire_2']
```

```python
In [ ]:


df_cnt_binary = df_cnt.copy()
df_cnt_binary = df_cnt_binary.set_index(['join_sn', 'ym'])
# df_cnt_binary = df_cnt_binary.set_index(['join_sn', 'ym']).applymap(lambda x: 1 if x > 0 else 0).reset_index()
df_cnt_binary = (df_cnt_binary > 0).astype(int).reset_index()
df_cnt_binary.head(2)
```

```python
In [8]:


df_cnt_binary.isna().sum()
```

```
Out[8]:

join_sn            0
ym                 0
i_cnt_all          0
i_cnt_whole        0
i_cnt_term         0
i_cnt_disease      0
i_cnt_health       0
i_cnt_cancer       0
i_cnt_nursing      0
i_cnt_child        0
i_cnt_dent         0
i_cnt_pen_sv       0
i_cnt_pen          0
i_cnt_sv           0
i_cnt_ed           0
i_cnt_drive        0
i_cnt_tour         0
i_cnt_golf         0
i_cnt_med          0
i_cnt_car          0
i_cnt_fire         0
i_cnt_liability    0
i_cnt_fire_2       0
i_cnt_else         0
life               0
disease            0
saving             0
fire               0
dtype: int64
```

```python
In [9]:


df_cnt_binary.shape
```

```
Out[9]:

(53373350, 28)
```

```python
In [10]:


colnames = ['join_sn', 'ym', 'i_has_all', 'i_has_whole', 'i_has_term',
       'i_has_disease', 'i_has_health', 'i_has_cancer', 'i_has_nursing',
       'i_has_child', 'i_has_dent', 'i_has_pen_sv', 'i_has_pen', 'i_has_sv',
       'i_has_ed', 'i_has_drive', 'i_has_tour', 'i_has_golf', 'i_has_med',
       'i_has_car', 'i_has_fire', 'i_has_liability', 'i_has_fire_2',
       'i_has_else', 'has_life', 'has_disease', 'has_saving', 'has_fire']
df_cnt_binary.columns = colnames
df_cnt_binary.columns
```

```
Out[10]:

Index(['join_sn', 'ym', 'i_has_all', 'i_has_whole', 'i_has_term',
       'i_has_disease', 'i_has_health', 'i_has_cancer', 'i_has_nursing',
       'i_has_child', 'i_has_dent', 'i_has_pen_sv', 'i_has_pen', 'i_has_sv',
       'i_has_ed', 'i_has_drive', 'i_has_tour', 'i_has_golf', 'i_has_med',
       'i_has_car', 'i_has_fire', 'i_has_liability', 'i_has_fire_2',
       'i_has_else', 'has_life', 'has_disease', 'has_saving', 'has_fire'],
      dtype='object')
```

```python
In [ ]:


df_cnt_filtered = df_cnt[(df_cnt['ym']==201912) | (df_cnt['ym']==202112)]
df_cnt_binary_filtered = df_cnt_binary[(df_cnt_binary['ym']==201912) | (df_cnt_binary['ym']==202112)]

df_cnt_filtered.head(2)
```

```python
In [12]:


df_credit_cnt = df_credit.merge(df_cnt_filtered, how='left', on=['join_sn', 'ym'])
# df_credit_cnt['post'] = df_credit_cnt['ym'].apply(lambda x: 1 if x==202112 else 0)
df_credit_cnt['post'] = (df_credit_cnt['ym'] == 202112).astype(int)

df_credit_bin = df_credit.merge(df_cnt_binary_filtered, how='left', on=['join_sn', 'ym'])
# df_credit_bin['post'] = df_credit_bin['ym'].apply(lambda x: 1 if x==202112 else 0)
df_credit_bin['post'] = (df_credit_bin['ym'] == 202112).astype(int)

print("보유여부 df_credit_bin 테이블: ", df_credit_bin.shape, "보유개수 df_credit_cnt 테이블", df_credit_cnt.shape)
print(df_credit_cnt.columns)
print(df_credit_bin.columns)
```

```
보유여부 df_credit_bin 테이블:  (1231640, 30) 보유개수 df_credit_cnt 테이블 (1231640, 30)
Index(['join_sn', 'hl', 'ym', 'i_cnt_all', 'i_cnt_whole', 'i_cnt_term',
       'i_cnt_disease', 'i_cnt_health', 'i_cnt_cancer', 'i_cnt_nursing',
       'i_cnt_child', 'i_cnt_dent', 'i_cnt_pen_sv', 'i_cnt_pen', 'i_cnt_sv',
       'i_cnt_ed', 'i_cnt_drive', 'i_cnt_tour', 'i_cnt_golf', 'i_cnt_med',
       'i_cnt_car', 'i_cnt_fire', 'i_cnt_liability', 'i_cnt_fire_2',
       'i_cnt_else', 'life', 'disease', 'saving', 'fire', 'post'],
      dtype='object')
Index(['join_sn', 'hl', 'ym', 'i_has_all', 'i_has_whole', 'i_has_term',
       'i_has_disease', 'i_has_health', 'i_has_cancer', 'i_has_nursing',
       'i_has_child', 'i_has_dent', 'i_has_pen_sv', 'i_has_pen', 'i_has_sv',
       'i_has_ed', 'i_has_drive', 'i_has_tour', 'i_has_golf', 'i_has_med',
       'i_has_car', 'i_has_fire', 'i_has_liability', 'i_has_fire_2',
       'i_has_else', 'has_life', 'has_disease', 'has_saving', 'has_fire',
       'post'],
      dtype='object')
```

```python
In [13]:


# 대출은 있으나 보험이 하나도 없는 차주-시점
print(df_credit_bin.isna().sum())
print(df_credit_cnt.isna().sum())
```

```
join_sn                0
hl                     0
ym                     0
i_has_all          94950
i_has_whole        94950
i_has_term         94950
i_has_disease      94950
i_has_health       94950
i_has_cancer       94950
i_has_nursing      94950
i_has_child        94950
i_has_dent         94950
i_has_pen_sv       94950
i_has_pen          94950
i_has_sv           94950
i_has_ed           94950
i_has_drive        94950
i_has_tour         94950
i_has_golf         94950
i_has_med          94950
i_has_car          94950
i_has_fire         94950
i_has_liability    94950
i_has_fire_2       94950
i_has_else         94950
has_life           94950
has_disease        94950
has_saving         94950
has_fire           94950
post                   0
dtype: int64
join_sn                0
hl                     0
ym                     0
i_cnt_all          94950
i_cnt_whole        94950
i_cnt_term         94950
i_cnt_disease      94950
i_cnt_health       94950
i_cnt_cancer       94950
i_cnt_nursing      94950
i_cnt_child        94950
i_cnt_dent         94950
i_cnt_pen_sv       94950
i_cnt_pen          94950
i_cnt_sv           94950
i_cnt_ed           94950
i_cnt_drive        94950
i_cnt_tour         94950
i_cnt_golf         94950
i_cnt_med          94950
i_cnt_car          94950
i_cnt_fire         94950
i_cnt_liability    94950
i_cnt_fire_2       94950
i_cnt_else         94950
life               94950
disease            94950
saving             94950
fire               94950
post                   0
dtype: int64
```

```python
In [14]:


# 대출은 있으나 보험이 하나도 없는 차주-시점은 보험보유 '없음' 보험개수 0개로 바꾼다
df_credit_bin = df_credit_bin.fillna(0)
df_credit_cnt = df_credit_cnt.fillna(0)
print(df_credit_bin.isna().sum())
print(df_credit_cnt.isna().sum())
```

```
join_sn            0
hl                 0
ym                 0
i_has_all          0
i_has_whole        0
i_has_term         0
i_has_disease      0
i_has_health       0
i_has_cancer       0
i_has_nursing      0
i_has_child        0
i_has_dent         0
i_has_pen_sv       0
i_has_pen          0
i_has_sv           0
i_has_ed           0
i_has_drive        0
i_has_tour         0
i_has_golf         0
i_has_med          0
i_has_car          0
i_has_fire         0
i_has_liability    0
i_has_fire_2       0
i_has_else         0
has_life           0
has_disease        0
has_saving         0
has_fire           0
post               0
dtype: int64
join_sn            0
hl                 0
ym                 0
i_cnt_all          0
i_cnt_whole        0
i_cnt_term         0
i_cnt_disease      0
i_cnt_health       0
i_cnt_cancer       0
i_cnt_nursing      0
i_cnt_child        0
i_cnt_dent         0
i_cnt_pen_sv       0
i_cnt_pen          0
i_cnt_sv           0
i_cnt_ed           0
i_cnt_drive        0
i_cnt_tour         0
i_cnt_golf         0
i_cnt_med          0
i_cnt_car          0
i_cnt_fire         0
i_cnt_liability    0
i_cnt_fire_2       0
i_cnt_else         0
life               0
disease            0
saving             0
fire               0
post               0
dtype: int64
```

```python
In [15]:


print(df_credit_bin[df_credit_bin['ym']==201912]['i_has_all'].value_counts())
print(df_credit_bin[df_credit_bin['ym']==202112]['i_has_all'].value_counts())
print(df_credit_bin[df_credit_bin['post']==0]['i_has_all'].value_counts())
print(df_credit_bin[df_credit_bin['post']==1]['i_has_all'].value_counts())

print(df_credit_cnt[df_credit_cnt['ym']==201912]['i_cnt_all'].value_counts())
print(df_credit_cnt[df_credit_cnt['ym']==202112]['i_cnt_all'].value_counts())
print(df_credit_cnt[df_credit_cnt['post']==0]['i_cnt_all'].value_counts())
print(df_credit_cnt[df_credit_cnt['post']==1]['i_cnt_all'].value_counts())
```

```
1.000    564298
0.000     51522
Name: i_has_all, dtype: int64
1.000    572392
0.000     43428
Name: i_has_all, dtype: int64
1.000    564298
0.000     51522
Name: i_has_all, dtype: int64
1.000    572392
0.000     43428
Name: i_has_all, dtype: int64
2.000      112733
3.000      102609
1.000       94720
4.000       79617
5.000       56101
0.000       51522
6.000       37511
7.000       25274
8.000       16571
9.000       11255
10.000       7723
11.000       5333
12.000       3725
13.000       2724
14.000       1982
15.000       1505
16.000       1107
17.000        808
18.000        633
19.000        503
20.000        402
21.000        308
22.000        231
23.000        180
24.000        136
25.000        109
26.000        102
27.000         72
28.000         61
29.000         45
30.000         34
31.000         30
32.000         23
33.000         21
35.000         16
36.000         13
38.000         13
34.000          8
37.000          7
40.000          7
39.000          6
45.000          6
42.000          5
43.000          4
53.000          3
41.000          3
44.000          3
54.000          2
46.000          2
48.000          2
47.000          2
65.000          1
60.000          1
49.000          1
55.000          1
63.000          1
69.000          1
51.000          1
117.000         1
Name: i_cnt_all, dtype: int64
2.000      100026
3.000       99805
4.000       83857
1.000       77286
5.000       63110
6.000       45055
0.000       43428
7.000       30903
8.000       21175
9.000       14312
10.000      10106
11.000       7044
12.000       5046
13.000       3553
14.000       2577
15.000       1941
16.000       1463
17.000       1118
18.000        829
19.000        670
20.000        466
21.000        395
22.000        300
23.000        248
24.000        189
25.000        166
26.000        125
27.000        117
29.000         73
28.000         68
30.000         54
31.000         40
32.000         39
33.000         36
34.000         30
35.000         23
38.000         23
37.000         18
36.000         17
40.000         16
39.000         12
41.000         11
46.000          5
51.000          5
45.000          5
52.000          5
43.000          4
42.000          4
48.000          3
44.000          3
47.000          3
50.000          2
68.000          2
142.000         1
53.000          1
57.000          1
91.000          1
58.000          1
80.000          1
77.000          1
55.000          1
49.000          1
Name: i_cnt_all, dtype: int64
2.000      112733
3.000      102609
1.000       94720
4.000       79617
5.000       56101
0.000       51522
6.000       37511
7.000       25274
8.000       16571
9.000       11255
10.000       7723
11.000       5333
12.000       3725
13.000       2724
14.000       1982
15.000       1505
16.000       1107
17.000        808
18.000        633
19.000        503
20.000        402
21.000        308
22.000        231
23.000        180
24.000        136
25.000        109
26.000        102
27.000         72
28.000         61
29.000         45
30.000         34
31.000         30
32.000         23
33.000         21
35.000         16
36.000         13
38.000         13
34.000          8
37.000          7
40.000          7
39.000          6
45.000          6
42.000          5
43.000          4
53.000          3
41.000          3
44.000          3
54.000          2
46.000          2
48.000          2
47.000          2
65.000          1
60.000          1
49.000          1
55.000          1
63.000          1
69.000          1
51.000          1
117.000         1
Name: i_cnt_all, dtype: int64
2.000      100026
3.000       99805
4.000       83857
1.000       77286
5.000       63110
6.000       45055
0.000       43428
7.000       30903
8.000       21175
9.000       14312
10.000      10106
11.000       7044
12.000       5046
13.000       3553
14.000       2577
15.000       1941
16.000       1463
17.000       1118
18.000        829
19.000        670
20.000        466
21.000        395
22.000        300
23.000        248
24.000        189
25.000        166
26.000        125
27.000        117
29.000         73
28.000         68
30.000         54
31.000         40
32.000         39
33.000         36
34.000         30
35.000         23
38.000         23
37.000         18
36.000         17
40.000         16
39.000         12
41.000         11
46.000          5
51.000          5
45.000          5
52.000          5
43.000          4
42.000          4
48.000          3
44.000          3
47.000          3
50.000          2
68.000          2
142.000         1
53.000          1
57.000          1
91.000          1
58.000          1
80.000          1
77.000          1
55.000          1
49.000          1
Name: i_cnt_all, dtype: int64
```

```python
In [16]:


cnt_columns = ['i_cnt_all', 'i_cnt_whole', 'i_cnt_term',
       'i_cnt_disease', 'i_cnt_health', 'i_cnt_cancer', 'i_cnt_nursing',
       'i_cnt_child', 'i_cnt_dent', 'i_cnt_pen_sv', 'i_cnt_pen', 'i_cnt_sv',
       'i_cnt_ed', 'i_cnt_drive', 'i_cnt_tour', 'i_cnt_golf', 'i_cnt_med',
       'i_cnt_car', 'i_cnt_fire', 'i_cnt_liability', 'i_cnt_fire_2',
       'i_cnt_else', 'life', 'disease', 'saving', 'fire']
has_columns = ['i_has_all', 'i_has_whole', 'i_has_term',
       'i_has_disease', 'i_has_health', 'i_has_cancer', 'i_has_nursing',
       'i_has_child', 'i_has_dent', 'i_has_pen_sv', 'i_has_pen', 'i_has_sv',
       'i_has_ed', 'i_has_drive', 'i_has_tour', 'i_has_golf', 'i_has_med',
       'i_has_car', 'i_has_fire', 'i_has_liability', 'i_has_fire_2',
       'i_has_else', 'has_life', 'has_disease', 'has_saving', 'has_fire']
```

```python
In [41]:


import statsmodels.formula.api as smf

results = []
for col in has_columns: 
    
    did_data = (df_credit_bin
                .groupby(['join_sn', 'post'])
                .agg({col: 'max', 'hl': 'max'})
                .reset_index()
               )

    formula = f'{col} ~ hl*post'
    model = smf.ols(formula, data = did_data).fit(cov_type='cluster', cov_kwds={'groups': did_data['join_sn']})
    results.append({
        'Column': col,
        'Intercept': model.params['Intercept'],
        'Intercept SE': model.bse['Intercept'],
        'D': model.params['hl'],
        'D SE': model.bse['hl'],
        'Post': model.params['post'],
        'Post SE': model.bse['post'],
        'D:Post': model.params['hl:post'],
        'D:Post SE': model.bse['hl:post'],
        'rsquared_adj':model.rsquared_adj,
        'observations': int(model.nobs)
    })

results_df = pd.DataFrame(results)
results_df.transpose()
```

```
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\regression\linear_model.py:1715: RuntimeWarning: invalid value encountered in double_scalars
  return 1 - self.ssr/self.centered_tss




Out[41]:







0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25




Column
i_has_all
i_has_whole
i_has_term
i_has_disease
i_has_health
i_has_cancer
i_has_nursing
i_has_child
i_has_dent
i_has_pen_sv
i_has_pen
i_has_sv
i_has_ed
i_has_drive
i_has_tour
i_has_golf
i_has_med
i_has_car
i_has_fire
i_has_liability
i_has_fire_2
i_has_else
has_life
has_disease
has_saving
has_fire


Intercept
0.918
0.228
0.050
0.491
0.542
0.263
0.052
0.067
0.109
0.044
0.139
0.125
0.002
0.382
0.014
0.002
0.019
0.000
0.047
0.000
0.000
0.070
0.263
0.601
0.256
0.047


Intercept SE
0.000
0.001
0.000
0.001
0.001
0.001
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.001
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.001
0.001
0.001
0.000


D
-0.017
-0.015
0.001
0.029
-0.027
0.041
0.000
0.010
0.049
-0.035
-0.084
-0.073
-0.001
0.009
-0.007
-0.001
0.004
0.000
-0.006
0.000
0.000
0.001
-0.014
0.032
-0.151
-0.006


D SE
0.001
0.002
0.001
0.002
0.002
0.002
0.001
0.001
0.002
0.001
0.001
0.001
0.000
0.002
0.000
0.000
0.001
0.000
0.001
0.000
0.000
0.001
0.002
0.002
0.002
0.001


Post
0.014
0.005
0.008
0.036
0.052
0.023
0.007
0.010
-0.001
0.002
-0.011
-0.024
0.000
0.083
-0.006
-0.001
0.004
0.000
0.009
0.000
0.000
0.006
0.010
0.034
-0.025
0.009


Post SE
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000


D:Post
-0.013
-0.018
-0.002
-0.020
-0.027
-0.012
-0.007
-0.002
-0.006
-0.004
-0.001
0.006
-0.000
-0.014
0.003
-0.000
-0.001
0.000
-0.009
0.000
0.000
-0.004
-0.019
-0.023
-0.001
-0.009


D:Post SE
0.001
0.001
0.001
0.002
0.002
0.002
0.001
0.001
0.001
0.000
0.001
0.001
0.000
0.002
0.000
0.000
0.000
0.000
0.001
0.000
0.000
0.001
0.002
0.002
0.001
0.001


rsquared_adj
0.001
0.000
0.000
0.001
0.003
0.001
0.000
0.000
0.001
0.002
0.005
0.005
0.000
0.007
0.001
0.000
0.000
NaN
0.001
NaN
NaN
0.000
0.000
0.001
0.009
0.001


observations
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
1231640
```

```python
In [ ]:


df_credit_bin.head(2)
```

```python
In [19]:


import statsmodels.formula.api as smf
df_credit_cnt_no = df_credit_cnt.copy()
results = [] 

for col in cnt_columns:
    # threshold
    threshold = df_credit_cnt_no[col].quantile(0.99)
    df_credit_cnt_no.loc[df_credit_cnt_no[col] > threshold, col] = None
    # drop na(outlier)
    did_data = (df_credit_cnt_no
                .dropna()
                .groupby(['join_sn', 'post'])
                .agg({col: 'max', 'hl': 'max'})
                .reset_index()
               )

    formula = f'{col} ~ hl*post'
    model = smf.ols(formula, data = did_data).fit(cov_type='cluster', cov_kwds={'groups': did_data['join_sn']})
    
    results.append({
        'Column': col,
        'Intercept': model.params['Intercept'],
        'Intercept SE': model.bse['Intercept'],
        'D': model.params['hl'],
        'D SE': model.bse['hl'],
        'Post': model.params['post'],
        'Post SE': model.bse['post'],
        'D:Post': model.params['hl:post'],
        'D:Post SE': model.bse['hl:post'],
        'rsquared_adj':model.rsquared_adj,
        'observations': int(model.nobs)
    })

results_df = pd.DataFrame(results)
results_df.transpose()
```

```
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\regression\linear_model.py:1715: RuntimeWarning: invalid value encountered in double_scalars
  return 1 - self.ssr/self.centered_tss
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\regression\linear_model.py:1715: RuntimeWarning: invalid value encountered in double_scalars
  return 1 - self.ssr/self.centered_tss
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\regression\linear_model.py:1715: RuntimeWarning: invalid value encountered in double_scalars
  return 1 - self.ssr/self.centered_tss
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\regression\linear_model.py:1715: RuntimeWarning: invalid value encountered in double_scalars
  return 1 - self.ssr/self.centered_tss
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\regression\linear_model.py:1715: RuntimeWarning: invalid value encountered in double_scalars
  return 1 - self.ssr/self.centered_tss




Out[19]:







0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25




Column
i_cnt_all
i_cnt_whole
i_cnt_term
i_cnt_disease
i_cnt_health
i_cnt_cancer
i_cnt_nursing
i_cnt_child
i_cnt_dent
i_cnt_pen_sv
i_cnt_pen
i_cnt_sv
i_cnt_ed
i_cnt_drive
i_cnt_tour
i_cnt_golf
i_cnt_med
i_cnt_car
i_cnt_fire
i_cnt_liability
i_cnt_fire_2
i_cnt_else
life
disease
saving
fire


Intercept
3.488
0.278
0.044
0.733
0.769
0.315
0.045
0.079
0.110
0.040
0.149
0.130
0.000
0.426
0.012
0.000
0.018
0.000
0.041
0.000
0.000
0.059
0.308
1.017
0.312
0.040


Intercept SE
0.004
0.001
0.000
0.001
0.001
0.001
0.000
0.000
0.000
0.000
0.001
0.001
0.000
0.001
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.001
0.002
0.001
0.000


D
-0.041
-0.023
-0.001
0.080
-0.029
0.062
-0.001
0.012
0.052
-0.032
-0.093
-0.077
0.000
0.018
-0.006
0.000
0.004
0.000
-0.006
0.000
0.000
-0.001
-0.022
0.131
-0.198
-0.006


D SE
0.014
0.003
0.001
0.005
0.004
0.003
0.001
0.002
0.002
0.001
0.001
0.001
0.000
0.003
0.000
0.000
0.001
0.000
0.001
0.000
0.000
0.001
0.003
0.007
0.002
0.001


Post
0.406
0.006
0.007
0.087
0.138
0.029
0.005
0.013
-0.002
0.001
-0.013
-0.027
0.000
0.116
-0.005
0.000
0.004
0.000
0.007
0.000
0.000
0.006
0.011
0.110
-0.038
0.007


Post SE
0.002
0.000
0.000
0.001
0.001
0.001
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.001
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.000
0.001
0.001
0.001
0.000


D:Post
-0.171
-0.023
-0.001
-0.032
-0.068
-0.017
-0.005
-0.002
-0.006
-0.002
0.000
0.009
0.000
-0.017
0.002
0.000
-0.001
0.000
-0.008
0.000
0.000
-0.002
-0.021
-0.048
0.007
-0.007


D:Post SE
0.010
0.002
0.001
0.004
0.004
0.003
0.001
0.001
0.002
0.000
0.001
0.001
0.000
0.003
0.000
0.000
0.001
0.000
0.001
0.000
0.000
0.001
0.002
0.005
0.002
0.001


rsquared_adj
0.005
0.000
0.000
0.002
0.006
0.001
0.000
0.000
0.001
0.002
0.004
0.004
NaN
0.008
0.001
NaN
0.000
NaN
0.000
NaN
NaN
0.000
0.000
0.002
0.008
0.000


observations
1220129
1214523
1209369
1204443
1197083
1192114
1188024
1184580
1181127
1177100
1169934
1162572
1160397
1157681
1156321
1154297
1154064
1154064
1150149
1150149
1150149
1144161
1143393
1142909
1142792
1142792
```

```python
In [18]:


import statsmodels.formula.api as smf
df_credit_cnt_no = df_credit_cnt.copy()

for col in cnt_columns:
    # threshold
    threshold = df_credit_cnt_no[col].quantile(0.99)
    df_credit_cnt_no.loc[df_credit_cnt_no[col] > threshold, col] = None
    # drop na(outlier)
    did_data = (df_credit_cnt_no
                .dropna()
                .groupby(['join_sn', 'post'])
                .agg({col: 'max', 'hl': 'max'})
                .reset_index()
               )

    formula = f'{col} ~ hl*post'
    model = smf.ols(formula, data = did_data).fit(cov_type='cluster', cov_kwds={'groups': did_data['join_sn']})
    
    print(model.summary())
```

```
OLS Regression Results                            
==============================================================================
Dep. Variable:              i_cnt_all   R-squared:                       0.005
Model:                            OLS   Adj. R-squared:                  0.005
Method:                 Least Squares   F-statistic:                 1.243e+04
Date:                Mon, 06 Jan 2025   Prob (F-statistic):               0.00
Time:                        18:59:55   Log-Likelihood:            -2.9728e+06
No. Observations:             1220129   AIC:                         5.946e+06
Df Residuals:                 1220125   BIC:                         5.946e+06
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      3.4882      0.004    978.861      0.000       3.481       3.495
hl            -0.0409      0.014     -2.950      0.003      -0.068      -0.014
post           0.4058      0.002    191.414      0.000       0.402       0.410
hl:post       -0.1711      0.010    -17.723      0.000      -0.190      -0.152
==============================================================================
Omnibus:                   226433.166   Durbin-Watson:                   1.173
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           413756.128
Skew:                           1.174   Prob(JB):                         0.00
Kurtosis:                       4.621   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:            i_cnt_whole   R-squared:                       0.000
Model:                            OLS   Adj. R-squared:                  0.000
Method:                 Least Squares   F-statistic:                     133.7
Date:                Mon, 06 Jan 2025   Prob (F-statistic):           1.31e-86
Time:                        18:59:58   Log-Likelihood:            -1.0582e+06
No. Observations:             1214523   AIC:                         2.116e+06
Df Residuals:                 1214519   BIC:                         2.116e+06
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.2783      0.001    362.111      0.000       0.277       0.280
hl            -0.0226      0.003     -8.186      0.000      -0.028      -0.017
post           0.0060      0.000     12.133      0.000       0.005       0.007
hl:post       -0.0227      0.002    -10.726      0.000      -0.027      -0.019
==============================================================================
Omnibus:                   544986.812   Durbin-Watson:                   1.207
Prob(Omnibus):                  0.000   Jarque-Bera (JB):          2386039.255
Skew:                           2.254   Prob(JB):                         0.00
Kurtosis:                       8.180   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:             i_cnt_term   R-squared:                       0.000
Model:                            OLS   Adj. R-squared:                  0.000
Method:                 Least Squares   F-statistic:                     399.1
Date:                Mon, 06 Jan 2025   Prob (F-statistic):          4.90e-259
Time:                        19:00:00   Log-Likelihood:             1.5257e+05
No. Observations:             1209369   AIC:                        -3.051e+05
Df Residuals:                 1209365   BIC:                        -3.051e+05
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.0445      0.000    161.792      0.000       0.044       0.045
hl            -0.0008      0.001     -0.737      0.461      -0.003       0.001
post           0.0069      0.000     33.870      0.000       0.006       0.007
hl:post       -0.0008      0.001     -0.907      0.364      -0.003       0.001
==============================================================================
Omnibus:                  1007634.318   Durbin-Watson:                   1.260
Prob(Omnibus):                  0.000   Jarque-Bera (JB):         16468050.389
Skew:                           4.238   Prob(JB):                         0.00
Kurtosis:                      18.968   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:          i_cnt_disease   R-squared:                       0.002
Model:                            OLS   Adj. R-squared:                  0.002
Method:                 Least Squares   F-statistic:                     3711.
Date:                Mon, 06 Jan 2025   Prob (F-statistic):               0.00
Time:                        19:00:02   Log-Likelihood:            -1.6935e+06
No. Observations:             1204443   AIC:                         3.387e+06
Df Residuals:                 1204439   BIC:                         3.387e+06
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.7325      0.001    577.291      0.000       0.730       0.735
hl             0.0804      0.005     15.807      0.000       0.070       0.090
post           0.0866      0.001    103.414      0.000       0.085       0.088
hl:post       -0.0319      0.004     -8.162      0.000      -0.040      -0.024
==============================================================================
Omnibus:                   306478.657   Durbin-Watson:                   1.209
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           687643.507
Skew:                           1.463   Prob(JB):                         0.00
Kurtosis:                       5.267   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:           i_cnt_health   R-squared:                       0.006
Model:                            OLS   Adj. R-squared:                  0.006
Method:                 Least Squares   F-statistic:                     7217.
Date:                Mon, 06 Jan 2025   Prob (F-statistic):               0.00
Time:                        19:00:04   Log-Likelihood:            -1.6075e+06
No. Observations:             1197083   AIC:                         3.215e+06
Df Residuals:                 1197079   BIC:                         3.215e+06
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.7685      0.001    651.532      0.000       0.766       0.771
hl            -0.0292      0.004     -6.485      0.000      -0.038      -0.020
post           0.1377      0.001    145.449      0.000       0.136       0.140
hl:post       -0.0678      0.004    -18.288      0.000      -0.075      -0.061
==============================================================================
Omnibus:                   177039.062   Durbin-Watson:                   1.292
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           268602.668
Skew:                           1.081   Prob(JB):                         0.00
Kurtosis:                       3.841   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:           i_cnt_cancer   R-squared:                       0.001
Model:                            OLS   Adj. R-squared:                  0.001
Method:                 Least Squares   F-statistic:                     1113.
Date:                Mon, 06 Jan 2025   Prob (F-statistic):               0.00
Time:                        19:00:06   Log-Likelihood:            -1.1185e+06
No. Observations:             1192114   AIC:                         2.237e+06
Df Residuals:                 1192110   BIC:                         2.237e+06
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.3154      0.001    391.012      0.000       0.314       0.317
hl             0.0617      0.003     18.500      0.000       0.055       0.068
post           0.0287      0.001     54.660      0.000       0.028       0.030
hl:post       -0.0165      0.003     -6.521      0.000      -0.021      -0.012
==============================================================================
Omnibus:                   444649.880   Durbin-Watson:                   1.209
Prob(Omnibus):                  0.000   Jarque-Bera (JB):          1446658.462
Skew:                           1.957   Prob(JB):                         0.00
Kurtosis:                       6.716   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:          i_cnt_nursing   R-squared:                       0.000
Model:                            OLS   Adj. R-squared:                  0.000
Method:                 Least Squares   F-statistic:                     196.5
Date:                Mon, 06 Jan 2025   Prob (F-statistic):          2.17e-127
Time:                        19:00:08   Log-Likelihood:             1.6021e+05
No. Observations:             1188024   AIC:                        -3.204e+05
Df Residuals:                 1188020   BIC:                        -3.204e+05
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.0447      0.000    161.102      0.000       0.044       0.045
hl            -0.0014      0.001     -1.325      0.185      -0.003       0.001
post           0.0050      0.000     24.011      0.000       0.005       0.005
hl:post       -0.0050      0.001     -5.644      0.000      -0.007      -0.003
==============================================================================
Omnibus:                   999345.468   Durbin-Watson:                   1.277
Prob(Omnibus):                  0.000   Jarque-Bera (JB):         16881142.767
Skew:                           4.284   Prob(JB):                         0.00
Kurtosis:                      19.359   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:            i_cnt_child   R-squared:                       0.000
Model:                            OLS   Adj. R-squared:                  0.000
Method:                 Least Squares   F-statistic:                     865.0
Date:                Mon, 06 Jan 2025   Prob (F-statistic):               0.00
Time:                        19:00:11   Log-Likelihood:            -3.7820e+05
No. Observations:             1184580   AIC:                         7.564e+05
Df Residuals:                 1184576   BIC:                         7.564e+05
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.0792      0.000    184.398      0.000       0.078       0.080
hl             0.0115      0.002      6.743      0.000       0.008       0.015
post           0.0125      0.000     49.563      0.000       0.012       0.013
hl:post       -0.0023      0.001     -2.023      0.043      -0.005   -7.14e-05
==============================================================================
Omnibus:                   986040.563   Durbin-Watson:                   1.162
Prob(Omnibus):                  0.000   Jarque-Bera (JB):         18702793.371
Skew:                           4.151   Prob(JB):                         0.00
Kurtosis:                      20.607   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:             i_cnt_dent   R-squared:                       0.001
Model:                            OLS   Adj. R-squared:                  0.001
Method:                 Least Squares   F-statistic:                     241.6
Date:                Mon, 06 Jan 2025   Prob (F-statistic):          1.18e-156
Time:                        19:00:13   Log-Likelihood:            -4.2972e+05
No. Observations:             1181127   AIC:                         8.595e+05
Df Residuals:                 1181123   BIC:                         8.595e+05
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.1103      0.000    238.114      0.000       0.109       0.111
hl             0.0516      0.002     24.863      0.000       0.048       0.056
post          -0.0021      0.000     -6.106      0.000      -0.003      -0.001
hl:post       -0.0059      0.002     -3.526      0.000      -0.009      -0.003
==============================================================================
Omnibus:                   765036.703   Durbin-Watson:                   1.276
Prob(Omnibus):                  0.000   Jarque-Bera (JB):          6918355.686
Skew:                           3.170   Prob(JB):                         0.00
Kurtosis:                      13.020   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:           i_cnt_pen_sv   R-squared:                       0.002
Model:                            OLS   Adj. R-squared:                  0.002
Method:                 Least Squares   F-statistic:                     1794.
Date:                Mon, 06 Jan 2025   Prob (F-statistic):               0.00
Time:                        19:00:15   Log-Likelihood:             2.7047e+05
No. Observations:             1177100   AIC:                        -5.409e+05
Df Residuals:                 1177096   BIC:                        -5.409e+05
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.0403      0.000    151.936      0.000       0.040       0.041
hl            -0.0324      0.001    -64.040      0.000      -0.033      -0.031
post           0.0013      0.000      7.971      0.000       0.001       0.002
hl:post       -0.0023      0.000     -6.165      0.000      -0.003      -0.002
==============================================================================
Omnibus:                  1086924.544   Durbin-Watson:                   1.185
Prob(Omnibus):                  0.000   Jarque-Bera (JB):         25894834.024
Skew:                           4.780   Prob(JB):                         0.00
Kurtosis:                      23.895   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:              i_cnt_pen   R-squared:                       0.004
Model:                            OLS   Adj. R-squared:                  0.004
Method:                 Least Squares   F-statistic:                     2815.
Date:                Mon, 06 Jan 2025   Prob (F-statistic):               0.00
Time:                        19:00:17   Log-Likelihood:            -5.6562e+05
No. Observations:             1169934   AIC:                         1.131e+06
Df Residuals:                 1169930   BIC:                         1.131e+06
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.1488      0.001    268.290      0.000       0.148       0.150
hl            -0.0934      0.001    -69.128      0.000      -0.096      -0.091
post          -0.0134      0.000    -39.378      0.000      -0.014      -0.013
hl:post        0.0002      0.001      0.212      0.832      -0.002       0.002
==============================================================================
Omnibus:                   711868.951   Durbin-Watson:                   1.199
Prob(Omnibus):                  0.000   Jarque-Bera (JB):          5454519.084
Skew:                           2.988   Prob(JB):                         0.00
Kurtosis:                      11.728   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:               i_cnt_sv   R-squared:                       0.004
Model:                            OLS   Adj. R-squared:                  0.004
Method:                 Least Squares   F-statistic:                     3519.
Date:                Mon, 06 Jan 2025   Prob (F-statistic):               0.00
Time:                        19:00:19   Log-Likelihood:            -4.6737e+05
No. Observations:             1162572   AIC:                         9.347e+05
Df Residuals:                 1162568   BIC:                         9.348e+05
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.1298      0.001    245.254      0.000       0.129       0.131
hl            -0.0772      0.001    -58.243      0.000      -0.080      -0.075
post          -0.0267      0.000    -75.288      0.000      -0.027      -0.026
hl:post        0.0088      0.001      8.887      0.000       0.007       0.011
==============================================================================
Omnibus:                   810311.890   Durbin-Watson:                   1.250
Prob(Omnibus):                  0.000   Jarque-Bera (JB):          8942916.468
Skew:                           3.413   Prob(JB):                         0.00
Kurtosis:                      14.748   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)






C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\regression\linear_model.py:1715: RuntimeWarning: invalid value encountered in double_scalars
  return 1 - self.ssr/self.centered_tss
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\base\model.py:1832: ValueWarning: covariance of constraints does not have full rank. The number of constraints is 3, but rank is 0
  warnings.warn('covariance of constraints does not have full '
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\base\model.py:1850: RuntimeWarning: invalid value encountered in true_divide
  F /= J
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\regression\linear_model.py:903: RuntimeWarning: divide by zero encountered in log
  llf = -nobs2*np.log(2*np.pi) - nobs2*np.log(ssr / nobs) - nobs2
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\stats\stattools.py:50: RuntimeWarning: invalid value encountered in double_scalars
  dw = np.sum(diff_resids**2, axis=axis) / np.sum(resids**2, axis=axis)






                            OLS Regression Results                            
==============================================================================
Dep. Variable:               i_cnt_ed   R-squared:                         nan
Model:                            OLS   Adj. R-squared:                    nan
Method:                 Least Squares   F-statistic:                       nan
Date:                Mon, 06 Jan 2025   Prob (F-statistic):                nan
Time:                        19:00:21   Log-Likelihood:                    inf
No. Observations:             1160397   AIC:                              -inf
Df Residuals:                 1160393   BIC:                              -inf
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept           0          0        nan        nan           0           0
hl                  0          0        nan        nan           0           0
post                0          0        nan        nan           0           0
hl:post             0          0        nan        nan           0           0
==============================================================================
Omnibus:                  2876778.461   Durbin-Watson:                     nan
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           435148.875
Skew:                           0.000   Prob(JB):                         0.00
Kurtosis:                       0.000   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:            i_cnt_drive   R-squared:                       0.008
Model:                            OLS   Adj. R-squared:                  0.008
Method:                 Least Squares   F-statistic:                     9825.
Date:                Mon, 06 Jan 2025   Prob (F-statistic):               0.00
Time:                        19:00:23   Log-Likelihood:            -1.1265e+06
No. Observations:             1157681   AIC:                         2.253e+06
Df Residuals:                 1157677   BIC:                         2.253e+06
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.4258      0.001    517.249      0.000       0.424       0.427
hl             0.0184      0.003      5.734      0.000       0.012       0.025
post           0.1156      0.001    167.960      0.000       0.114       0.117
hl:post       -0.0169      0.003     -5.849      0.000      -0.023      -0.011
==============================================================================
Omnibus:                   198336.485   Durbin-Watson:                   1.316
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           324563.209
Skew:                           1.171   Prob(JB):                         0.00
Kurtosis:                       4.116   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:             i_cnt_tour   R-squared:                       0.001
Model:                            OLS   Adj. R-squared:                  0.001
Method:                 Least Squares   F-statistic:                     586.8
Date:                Mon, 06 Jan 2025   Prob (F-statistic):               0.00
Time:                        19:00:26   Log-Likelihood:             1.0565e+06
No. Observations:             1156321   AIC:                        -2.113e+06
Df Residuals:                 1156317   BIC:                        -2.113e+06
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.0124      0.000     82.329      0.000       0.012       0.013
hl            -0.0057      0.000    -13.458      0.000      -0.007      -0.005
post          -0.0052      0.000    -39.486      0.000      -0.005      -0.005
hl:post        0.0025      0.000      6.599      0.000       0.002       0.003
==============================================================================
Omnibus:                  1773141.202   Durbin-Watson:                   1.475
Prob(Omnibus):                  0.000   Jarque-Bera (JB):        500828143.779
Skew:                          10.092   Prob(JB):                         0.00
Kurtosis:                     102.938   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)






C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\regression\linear_model.py:1715: RuntimeWarning: invalid value encountered in double_scalars
  return 1 - self.ssr/self.centered_tss
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\base\model.py:1832: ValueWarning: covariance of constraints does not have full rank. The number of constraints is 3, but rank is 0
  warnings.warn('covariance of constraints does not have full '
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\base\model.py:1850: RuntimeWarning: invalid value encountered in true_divide
  F /= J
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\regression\linear_model.py:903: RuntimeWarning: divide by zero encountered in log
  llf = -nobs2*np.log(2*np.pi) - nobs2*np.log(ssr / nobs) - nobs2
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\stats\stattools.py:50: RuntimeWarning: invalid value encountered in double_scalars
  dw = np.sum(diff_resids**2, axis=axis) / np.sum(resids**2, axis=axis)






                            OLS Regression Results                            
==============================================================================
Dep. Variable:             i_cnt_golf   R-squared:                         nan
Model:                            OLS   Adj. R-squared:                    nan
Method:                 Least Squares   F-statistic:                       nan
Date:                Mon, 06 Jan 2025   Prob (F-statistic):                nan
Time:                        19:00:28   Log-Likelihood:                    inf
No. Observations:             1154297   AIC:                              -inf
Df Residuals:                 1154293   BIC:                              -inf
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept           0          0        nan        nan           0           0
hl                  0          0        nan        nan           0           0
post                0          0        nan        nan           0           0
hl:post             0          0        nan        nan           0           0
==============================================================================
Omnibus:                  2861656.929   Durbin-Watson:                     nan
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           432861.375
Skew:                           0.000   Prob(JB):                         0.00
Kurtosis:                       0.000   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:              i_cnt_med   R-squared:                       0.000
Model:                            OLS   Adj. R-squared:                  0.000
Method:                 Least Squares   F-statistic:                     390.3
Date:                Mon, 06 Jan 2025   Prob (F-statistic):          2.70e-253
Time:                        19:00:30   Log-Likelihood:             6.2000e+05
No. Observations:             1154064   AIC:                        -1.240e+06
Df Residuals:                 1154060   BIC:                        -1.240e+06
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.0183      0.000    100.178      0.000       0.018       0.019
hl             0.0043      0.001      5.775      0.000       0.003       0.006
post           0.0037      0.000     33.129      0.000       0.003       0.004
hl:post       -0.0007      0.001     -1.397      0.162      -0.002       0.000
==============================================================================
Omnibus:                  1382779.785   Durbin-Watson:                   1.172
Prob(Omnibus):                  0.000   Jarque-Bera (JB):        101877449.648
Skew:                           6.780   Prob(JB):                         0.00
Kurtosis:                      46.986   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)






C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\regression\linear_model.py:1715: RuntimeWarning: invalid value encountered in double_scalars
  return 1 - self.ssr/self.centered_tss
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\base\model.py:1832: ValueWarning: covariance of constraints does not have full rank. The number of constraints is 3, but rank is 0
  warnings.warn('covariance of constraints does not have full '
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\base\model.py:1850: RuntimeWarning: invalid value encountered in true_divide
  F /= J
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\regression\linear_model.py:903: RuntimeWarning: divide by zero encountered in log
  llf = -nobs2*np.log(2*np.pi) - nobs2*np.log(ssr / nobs) - nobs2
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\stats\stattools.py:50: RuntimeWarning: invalid value encountered in double_scalars
  dw = np.sum(diff_resids**2, axis=axis) / np.sum(resids**2, axis=axis)






                            OLS Regression Results                            
==============================================================================
Dep. Variable:              i_cnt_car   R-squared:                         nan
Model:                            OLS   Adj. R-squared:                    nan
Method:                 Least Squares   F-statistic:                       nan
Date:                Mon, 06 Jan 2025   Prob (F-statistic):                nan
Time:                        19:00:32   Log-Likelihood:                    inf
No. Observations:             1154064   AIC:                              -inf
Df Residuals:                 1154060   BIC:                              -inf
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept           0          0        nan        nan           0           0
hl                  0          0        nan        nan           0           0
post                0          0        nan        nan           0           0
hl:post             0          0        nan        nan           0           0
==============================================================================
Omnibus:                  2861079.336   Durbin-Watson:                     nan
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           432774.000
Skew:                           0.000   Prob(JB):                         0.00
Kurtosis:                       0.000   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:             i_cnt_fire   R-squared:                       0.000
Model:                            OLS   Adj. R-squared:                  0.000
Method:                 Least Squares   F-statistic:                     299.6
Date:                Mon, 06 Jan 2025   Prob (F-statistic):          2.28e-194
Time:                        19:00:34   Log-Likelihood:             1.9868e+05
No. Observations:             1150149   AIC:                        -3.974e+05
Df Residuals:                 1150145   BIC:                        -3.973e+05
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.0406      0.000    150.672      0.000       0.040       0.041
hl            -0.0061      0.001     -6.512      0.000      -0.008      -0.004
post           0.0070      0.000     27.804      0.000       0.006       0.007
hl:post       -0.0076      0.001     -8.462      0.000      -0.009      -0.006
==============================================================================
Omnibus:                  1006203.788   Durbin-Watson:                   1.400
Prob(Omnibus):                  0.000   Jarque-Bera (JB):         19554520.946
Skew:                           4.482   Prob(JB):                         0.00
Kurtosis:                      21.102   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)






C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\regression\linear_model.py:1715: RuntimeWarning: invalid value encountered in double_scalars
  return 1 - self.ssr/self.centered_tss
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\base\model.py:1832: ValueWarning: covariance of constraints does not have full rank. The number of constraints is 3, but rank is 0
  warnings.warn('covariance of constraints does not have full '
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\base\model.py:1850: RuntimeWarning: invalid value encountered in true_divide
  F /= J
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\regression\linear_model.py:903: RuntimeWarning: divide by zero encountered in log
  llf = -nobs2*np.log(2*np.pi) - nobs2*np.log(ssr / nobs) - nobs2
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\stats\stattools.py:50: RuntimeWarning: invalid value encountered in double_scalars
  dw = np.sum(diff_resids**2, axis=axis) / np.sum(resids**2, axis=axis)






                            OLS Regression Results                            
==============================================================================
Dep. Variable:        i_cnt_liability   R-squared:                         nan
Model:                            OLS   Adj. R-squared:                    nan
Method:                 Least Squares   F-statistic:                       nan
Date:                Mon, 06 Jan 2025   Prob (F-statistic):                nan
Time:                        19:00:36   Log-Likelihood:                    inf
No. Observations:             1150149   AIC:                              -inf
Df Residuals:                 1150145   BIC:                              -inf
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept           0          0        nan        nan           0           0
hl                  0          0        nan        nan           0           0
post                0          0        nan        nan           0           0
hl:post             0          0        nan        nan           0           0
==============================================================================
Omnibus:                  2851374.288   Durbin-Watson:                     nan
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           431305.875
Skew:                           0.000   Prob(JB):                         0.00
Kurtosis:                       0.000   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)






C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\regression\linear_model.py:1715: RuntimeWarning: invalid value encountered in double_scalars
  return 1 - self.ssr/self.centered_tss
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\base\model.py:1832: ValueWarning: covariance of constraints does not have full rank. The number of constraints is 3, but rank is 0
  warnings.warn('covariance of constraints does not have full '
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\base\model.py:1850: RuntimeWarning: invalid value encountered in true_divide
  F /= J
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\regression\linear_model.py:903: RuntimeWarning: divide by zero encountered in log
  llf = -nobs2*np.log(2*np.pi) - nobs2*np.log(ssr / nobs) - nobs2
C:\ProgramData\Anaconda3\lib\site-packages\statsmodels\stats\stattools.py:50: RuntimeWarning: invalid value encountered in double_scalars
  dw = np.sum(diff_resids**2, axis=axis) / np.sum(resids**2, axis=axis)






                            OLS Regression Results                            
==============================================================================
Dep. Variable:           i_cnt_fire_2   R-squared:                         nan
Model:                            OLS   Adj. R-squared:                    nan
Method:                 Least Squares   F-statistic:                       nan
Date:                Mon, 06 Jan 2025   Prob (F-statistic):                nan
Time:                        19:00:38   Log-Likelihood:                    inf
No. Observations:             1150149   AIC:                              -inf
Df Residuals:                 1150145   BIC:                              -inf
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept           0          0        nan        nan           0           0
hl                  0          0        nan        nan           0           0
post                0          0        nan        nan           0           0
hl:post             0          0        nan        nan           0           0
==============================================================================
Omnibus:                  2851374.288   Durbin-Watson:                     nan
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           431305.875
Skew:                           0.000   Prob(JB):                         0.00
Kurtosis:                       0.000   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:             i_cnt_else   R-squared:                       0.000
Model:                            OLS   Adj. R-squared:                  0.000
Method:                 Least Squares   F-statistic:                     125.4
Date:                Mon, 06 Jan 2025   Prob (F-statistic):           3.13e-81
Time:                        19:00:40   Log-Likelihood:                 5521.9
No. Observations:             1144161   AIC:                        -1.104e+04
Df Residuals:                 1144157   BIC:                        -1.099e+04
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.0592      0.000    183.354      0.000       0.059       0.060
hl            -0.0013      0.001     -1.060      0.289      -0.004       0.001
post           0.0056      0.000     19.087      0.000       0.005       0.006
hl:post       -0.0024      0.001     -1.975      0.048      -0.005   -1.81e-05
==============================================================================
Omnibus:                   826779.534   Durbin-Watson:                   1.396
Prob(Omnibus):                  0.000   Jarque-Bera (JB):          8547011.850
Skew:                           3.638   Prob(JB):                         0.00
Kurtosis:                      14.240   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:                   life   R-squared:                       0.000
Model:                            OLS   Adj. R-squared:                  0.000
Method:                 Least Squares   F-statistic:                     184.7
Date:                Mon, 06 Jan 2025   Prob (F-statistic):          1.08e-119
Time:                        19:00:43   Log-Likelihood:            -1.0422e+06
No. Observations:             1143393   AIC:                         2.084e+06
Df Residuals:                 1143389   BIC:                         2.085e+06
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.3084      0.001    376.023      0.000       0.307       0.310
hl            -0.0217      0.003     -7.344      0.000      -0.027      -0.016
post           0.0110      0.001     19.850      0.000       0.010       0.012
hl:post       -0.0214      0.002     -9.034      0.000      -0.026      -0.017
==============================================================================
Omnibus:                   457835.671   Durbin-Watson:                   1.231
Prob(Omnibus):                  0.000   Jarque-Bera (JB):          1657297.853
Skew:                           2.062   Prob(JB):                         0.00
Kurtosis:                       7.216   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:                disease   R-squared:                       0.002
Model:                            OLS   Adj. R-squared:                  0.002
Method:                 Least Squares   F-statistic:                     3527.
Date:                Mon, 06 Jan 2025   Prob (F-statistic):               0.00
Time:                        19:00:45   Log-Likelihood:            -1.8462e+06
No. Observations:             1142909   AIC:                         3.692e+06
Df Residuals:                 1142905   BIC:                         3.692e+06
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      1.0173      0.002    633.717      0.000       1.014       1.020
hl             0.1310      0.007     20.059      0.000       0.118       0.144
post           0.1097      0.001    100.266      0.000       0.108       0.112
hl:post       -0.0478      0.005     -9.351      0.000      -0.058      -0.038
==============================================================================
Omnibus:                   280553.346   Durbin-Watson:                   1.223
Prob(Omnibus):                  0.000   Jarque-Bera (JB):           628360.769
Skew:                           1.410   Prob(JB):                         0.00
Kurtosis:                       5.290   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:                 saving   R-squared:                       0.008
Model:                            OLS   Adj. R-squared:                  0.008
Method:                 Least Squares   F-statistic:                     5955.
Date:                Mon, 06 Jan 2025   Prob (F-statistic):               0.00
Time:                        19:00:47   Log-Likelihood:            -1.0432e+06
No. Observations:             1142792   AIC:                         2.086e+06
Df Residuals:                 1142788   BIC:                         2.086e+06
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.3115      0.001    357.552      0.000       0.310       0.313
hl            -0.1980      0.002    -95.351      0.000      -0.202      -0.194
post          -0.0378      0.001    -68.529      0.000      -0.039      -0.037
hl:post        0.0068      0.002      4.431      0.000       0.004       0.010
==============================================================================
Omnibus:                   567573.569   Durbin-Watson:                   1.213
Prob(Omnibus):                  0.000   Jarque-Bera (JB):          3118736.553
Skew:                           2.431   Prob(JB):                         0.00
Kurtosis:                       9.469   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
                            OLS Regression Results                            
==============================================================================
Dep. Variable:                   fire   R-squared:                       0.000
Model:                            OLS   Adj. R-squared:                  0.000
Method:                 Least Squares   F-statistic:                     301.2
Date:                Mon, 06 Jan 2025   Prob (F-statistic):          2.22e-195
Time:                        19:00:49   Log-Likelihood:             2.0022e+05
No. Observations:             1142792   AIC:                        -4.004e+05
Df Residuals:                 1142788   BIC:                        -4.004e+05
Df Model:                           3                                         
Covariance Type:              cluster                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept      0.0403      0.000    149.748      0.000       0.040       0.041
hl            -0.0062      0.001     -6.616      0.000      -0.008      -0.004
post           0.0070      0.000     27.904      0.000       0.007       0.008
hl:post       -0.0074      0.001     -8.259      0.000      -0.009      -0.006
==============================================================================
Omnibus:                  1002277.887   Durbin-Watson:                   1.401
Prob(Omnibus):                  0.000   Jarque-Bera (JB):         19656836.624
Skew:                           4.496   Prob(JB):                         0.00
Kurtosis:                      21.220   Cond. No.                         10.2
==============================================================================

Notes:
[1] Standard Errors are robust to cluster correlation (cluster)
```

#### 차주번호와 hl (hl=0이면 고고, hl=1이면 고저)¶

## 1. 전처리¶

보유 여부, 보유 개수 테이블 만들기


2019 12, 2021 12만 필터링


신용 테이블에 보유여부, 보유개수 테이블 쪼인


보유여부 확인 시 사용할 컬럼, 보유개수 확인 시 사용할 컬럼


# 1.1 보유여부 - ols¶

# 2.1 보유개수 - ols¶